<?xml version="1.0"?>
<openerp>
    <data>
         <record id="ir_print_all_report_server_action" model="ir.actions.server">
             <field name="name">Print all report</field>
             <field name="type">ir.actions.server</field>
             <field name="model_id" ref="sale.model_sale_order" />
             <field name="binding_model_id" ref="sale.model_sale_order" />
             <field name="state">code</field>
             <field name="code">
                 action = records.print_all_server_action()
             </field>
         </record>

         <record id="ir_print_all_report_server_sequential_print_action" model="ir.actions.server">
             <field name="name">Stampa fatture seq.</field>
             <field name="type">ir.actions.server</field>
             <field name="model_id" ref="sale.model_sale_order" />
             <field name="binding_model_id" ref="sale.model_sale_order" />
             <field name="state">code</field>
             <field name="code">
                 action = records.sequential_print_all_server_action()
             </field>
         </record>
         <record id="ir_confirm_all_selected_order_server_action" model="ir.actions.server">
             <field name="name">Confirm selected ready order</field>
             <field name="type">ir.actions.server</field>
             <field name="model_id" ref="sale.model_sale_order" />
             <field name="binding_model_id" ref="sale.model_sale_order" />
             <field name="state">code</field>
             <field name="code">
                 action = records.confirm_all_selected_server_action()
             </field>
         </record>
        <record model="ir.actions.server" id="server_acton_stock_move_load_document_generator">
            <field name="name">Document generator</field>
            <field name="model_id" ref="stock.model_stock_move"/>
            <field name="sequence">1</field>
            <field name="type">ir.actions.server</field>
            <field name="state">code</field>
            <field name="code">
                action = records.generate_delivery_orders_from_line()
            </field>
       </record>

        <!--sale.order.print.result-->
        <record model="ir.ui.view" id="view_account_fiscal_position_tree">
            <field name="name">account.fiscal.position.tree</field>
            <field name="model">account.fiscal.position</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <tree string="Account position">
                    <field name="name" />
                    <field name="print_group" />
                    <field name="sequential_print" />
                </tree>
            </field>
        </record>
        <record model="ir.ui.view" id="view_account_fiscal_position_form">
            <field name="name">account.fiscal.position.form</field>
            <field name="model">account.fiscal.position</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <form string="Account position">
                    <sheet>
                        <group col="4" colspan="4">
                            <field name="name" readonly="1"/>
                            <newline/>
                            <field name="print_group" />
                            <field name="sequential_print" />
                            <separator string="Print parameters:" colspan="4" />
                            <field name="print_ids" colspan="4" nolabel="1">
                                <tree string="Print options" editable="bottom">
                                    <field name="market" />
                                    <field name="report_picking" />
                                    <field name="report_ddt" />
                                    <field name="report_invoice" />
                                    <field name="report_extra" />
                                    <field name="report_label" />
                                </tree>
                            </field>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_account_fiscal_position_print_form">
            <field name="name">Fiscal print parameter</field>
            <field name="res_model">account.fiscal.position</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_account_fiscal_position_tree"/>
            <field name="context">{'form_view_ref': 'tyres_logistic_pick_in_load.view_account_fiscal_position_form'}</field>
            <field name="domain">[]</field>
        </record>

        <!--sale.order.print.result-->
        <record model="ir.ui.view" id="view_sale_order_print_result_form">
            <field name="name">sale.order.print.result.form</field>
            <field name="model">sale.order.print.result</field>
            <field name="arch" type="xml">
                <form string="Result printing">
                    <sheet>
                        <group col="4" colspan="4">
                            <separator string="Print result:" colspan="4"/>
                            <field name="note" colspan="4" nolabel="1" widget="html" readonly="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="view_purchase_order_line_tree">
            <field name="name">purchase.order.line.tree</field>
            <field name="model">purchase.order.line</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <tree string="Purchase line" >
                     <field name="order_id" />
                     <field name="product_id" />
                     <field name="name" />
                     <field name="product_qty" />
                     <field name="date_planned" />

                     <!--Total: -->
                     <field name="logistic_delivered_qty" />
                     <field name="logistic_undelivered_qty" />

                     <!--Sale reference:-->
                     <field name="logistic_sale_id" />
                     <field name="load_line_ids" />
                </tree>
            </field>
        </record>
        <record model="ir.ui.view" id="view_purchase_order_line_form">
            <field name="name">purchase.order.line.form</field>
            <field name="model">purchase.order.line</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <form string="Purchase line">
                    <sheet>
                        <group colspan="4" col="4">
                             <field name="order_id" />
                             <field name="logistic_source" />

                             <field name="product_id" />
                             <field name="name" />

                             <field name="product_qty" />
                             <field name="date_planned" />

                             <!--Total: -->
                             <field name="logistic_delivered_qty" />
                             <field name="logistic_undelivered_qty" />

                             <!--Sale reference:-->
                             <field name="logistic_sale_id" />
                             <separator string="Stock move loads:" colspan="4"/>
                             <field name="load_line_ids" colspan="4" nolabel="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!--PURCHASE STOCK MANAGEMENT:-->
        <record model="ir.ui.view" id="view_delivery_selection_tree">
            <field name="name">purchase.order.line.tree</field>
            <field name="model">purchase.order.line</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <tree string="Purchase line" default_order="create_date,product_id" editable="bottom" create="false"
                        decoration-success="check_status in ('total', 'done') and logistic_delivered_manual&gt;0"
                        decoration-muted="logistic_undelivered_qty==0"
                        decoration-warning="check_status=='partial' and logistic_delivered_manual&gt;0"
                        decoration-danger="logistic_source=='refund'">

                     <button name="clean_fast_filter" string="Remove filters" type="object" icon="fa-home fa-2x" />
                     <field name="logistic_source" invisible="1"/>
                     <field name="order_id" readonly="1" string="Rif." invisible="1"/>
                     <!--<field name="customer_order_date" readonly="1" invisible="not context.get('internal_view')"/>-->
                     <field name="purchase_order_date" readonly="1" invisible="not context.get('internal_view')"/>
                     <field name="internal_note" string="Note" invisible="not context.get('internal_view')"/>

                     <button name="open_detail_delivery_in" string="Open detail for line" type="object" icon="fa-list-alt fa-2x"/>
                     <button name="fast_filter_product_id" string="Filter this product" type="object" icon="fa-search fa-2x"  attrs="{'invisible': [('product_id','=',False)]}" />
                     <field name="product_id" readonly="1" invisible="1"/>
                     <field name="product_name" readonly="1" invisible="1"/>
                     <field name="name_extended_stock" readonly="1" widget="html"/>
                     <!--<field name="name" readonly="1" />-->
                     <field name="date_planned" readonly="1" invisible="1"/>

                     <button name="fast_filter_supplier" string="Filter this supplier" type="object" icon="fa-search fa-2x" attrs="{'invisible': [('order_supplier_id','=',False)]}" />
                     <field name="order_supplier_id" readonly="1" string="Fornitore" invisible="1"/>
                     <field name="order_supplier_name" readonly="1" string="Fornitore"/>
                     <field name="user_select_id" invisible="1" />
                     <field name="check_status" invisible="1" />

                     <button name="fast_filter_larghezza" string="Filter this width" type="object" icon="fa-search fa-2x"  attrs="{'invisible': [('larghezza','=',False)]}" />
                     <field name="larghezza" readonly="1" string="L."/>
                     <button name="fast_filter_spalla" string="Filter this shoulder" type="object" icon="fa-search fa-2x"  attrs="{'invisible': [('spalla','=',False)]}" />
                     <field name="spalla" readonly="1" string="Sp."/>
                     <button name="fast_filter_raggio" string="Filter this ray" type="object" icon="fa-search fa-2x"  attrs="{'invisible': [('raggio','=',False)]}" />
                     <field name="raggio" readonly="1" string="r."/>

                     <!--Total: -->
                     <field name="product_qty" readonly="1" string="Ord." invisible="1"/>
                     <field name="logistic_delivered_qty" readonly="1" string="Cons." invisible="1"/>
                     <field name="logistic_undelivered_qty" readonly="1" string="Rim."/>

                     <button name="delivery_0" string="0" type="object" icon="fa-bitbucket fa-2x" />
                     <button name="delivery_less_1" string="-" type="object" icon="fa-minus-square fa-2x" />
                     <button name="delivery_more_1" string="+" type="object"  icon="fa-plus-square fa-2x" />
                     <button name="delivery_all" string="Arrivo" type="object" icon="fa-fast-forward fa-2x" />

                     <field name="logistic_delivered_manual" string="Arrivo" readonly="1" />
                     <button name="create_delivery_orders" string="Create delivery orders"
                         type="object" icon="fa-download fa-2x"
                         confirm="Do you confirm the generation of all supplier delivery document (you selection)?"
                         />
                     <button name="dummy" string="Order not web (internal or workshop)" type="object" icon="fa-bell"  attrs="{'invisible': [('logistic_source','in',(False, 'web'))]}" />
                </tree>
            </field>
        </record>
        <!--TODO -->
        <record model="ir.ui.view" id="view_delivery_selection_form">
            <field name="name">purchase.order.line.form</field>
            <field name="model">purchase.order.line</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <form string="Purchase line">
                    <header>
                    </header>
                    <sheet>
                        <group colspan="4" col="4" >
                             <field name="order_id" readonly="1"/>
                             <field name="logistic_source" />

                             <field name="order_supplier_id" readonly="1"/>
                             <field name="logistic_sale_id" readonly="1"/>

                             <field name="product_id" readonly="1"/>
                             <field name="name" readonly="1"/>

                             <field name="product_qty" readonly="1"/>
                             <notebook colspan="4">
                                 <page string="Tyres">
                                     <group colspan="4" col="6">
                                         <field name="larghezza" readonly="1"/>
                                         <field name="spalla" readonly="1"/>
                                         <field name="raggio" readonly="1"/>
                                     </group>
                                 </page>
                                 <page string="Delivery">
                                     <group colspan="4" col="4">
                                         <field name="date_planned" readonly="1"/>
                                         <!--Total: -->
                                         <field name="logistic_delivered_qty" readonly="1"/>
                                         <field name="logistic_undelivered_qty" readonly="1" />
                                     </group>
                                 </page>
                             </notebook>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!--Add also in original serch (instead not filter!)-->
        <record model="ir.ui.view" id="view_delivery_selection_inherited_search">
            <field name="name">purchase.order.line.tree</field>
            <field name="model">purchase.order.line</field>
            <field name="inherit_id" ref="purchase.purchase_order_line_search"/>
            <field name="arch" type="xml">
                <field name="order_id" position="before">
                    <field name="misuracompleta" />
                </field>

                <field name="order_id" position="after">
                    <field name="order_supplier_id" filter_domain="[('order_supplier_id','=',self)]"/>

                    <field name="larghezza" />
                    <field name="spalla" />
                    <field name="raggio" />
                </field>
            </field>
        </record>

        <record model="ir.ui.view" id="view_delivery_selection_search">
            <field name="name">purchase.order.line.search</field>
            <field name="model">purchase.order.line</field>
            <field name="priority" eval="40"/>
            <field name="arch" type="xml">
                <search string="Purchase line">
                    <field name="misuracompleta" />
                    <field name="name" />
                    <field name="product_id" filter_domain="[('product_id','=',self)]"/>
                    <field name="order_id" filter_domain="[('order_id.name','ilike',self)]"/>

                    <field name="order_supplier_id" filter_domain="[('order_supplier_id.name','ilike',self)]"/>

                    <field name="larghezza" />
                    <field name="spalla" />
                    <field name="raggio" />

                    <filter name="my_selection" string="Current selected" domain="[('user_select_id', '=', uid), ('logistic_delivered_manual','&gt;',0)]"/><!--TODO Change ('delivery_id','=',False), -->

                    <filter name="refund_selection" string="Solo resi" domain="[('logistic_source', '=', 'refund')]"/>
                    <filter name="no_refund_selection" string="Senza resi" domain="[('logistic_source', '!=', 'refund')]"/>

                    <!--<filter name="state_draft" string="Draft state" domain="[('state','=','draft')]"/>-->
                    <group expand="0" string="Group By...">

                        <filter name="group_larghezza" string="Width" context="{'group_by': 'larghezza'}"/>
                        <filter name="group_spalla" string="Shoulder" context="{'group_by': 'spalla'}"/>
                        <filter name="group_raggio" string="Ray" context="{'group_by': 'raggio'}"/>

                        <filter name="group_purchase" string="Purchase order" context="{'group_by': 'order_id'}"/>
                        <filter name="group_product" string="Product" context="{'group_by': 'product_id'}"/>
                        <filter name="group_supplier" string="Supplier" context="{'group_by': 'order_supplier_id'}"/>

                        <filter name="group_create" string="Create" context="{'group_by': 'create_date:day'}"/>

                        <!--<filter string="Status" context="{'group_by': 'state'}" />-->
                    </group>
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="view_delivery_selection_stock_move_search">
            <field name="name">stock.move.search</field>
            <field name="model">stock.move</field>
            <field name="arch" type="xml">
                <search string="String">
                    <field name="name" />
                    <!--TODO-->
                    <field name="partner_id" filter_domain="[('partner_id.name','ilike',self)]"/>
                    <field name="product_id" filter_domain="[('product_id','=',self)]"/>

                    <filter name="dropship_manage_selected" string="Dropship line" domain="[('dropship_manage','=',True)]"/>
                    <group expand="0" string="Group By...">
                        <filter name="group_date_day" string="Day" context="{'group_by': 'date:day'}"/>
                        <filter name="group_date_week" string="Week" context="{'group_by': 'date:week'}"/>
                        <filter name="group_product" string="Product" context="{'group_by': 'product_id'}"/>
                        <filter name="group_partner" string="Partner" context="{'group_by': 'partner_id'}"/>
                        <filter name="group_dropship" string="Dropship" context="{'group_by': 'dropship_manage'}"/>
                    </group>
                </search>
            </field>
        </record>
        <record model="ir.ui.view" id="view_delivery_selection_stock_move_tree">
            <field name="name">stock.move.tree</field>
            <field name="model">stock.move</field>
            <field name="arch" type="xml">
                <tree string="Orphan stock move" default_order="partner_id" editable="bottom" decoration-primary="dropship_manage==True">
                    <field name="picking_id" invisible="1"/>
                    <field name="force_hide" invisible="1" />
                    <field name="date" />
                    <field name="internal_note" />
                    <field name="partner_id" readonly="1"/>
                    <field name="product_id" readonly="1" invisible="1"/>
                    <field name="name" readonly="1" invisible="1"/>
                    <field name="default_code" readonly="1"/>
                    <field name="name_extended" readonly="1" />
                    <field name="price_unit" readonly="1"/>
                    <field name="logistic_load_id" readonly="1"/>
                    <field name="product_uom_qty" readonly="1" />
                    <field name="dropship_manage" invisible="1"/>
                    <field name="state" invisible="1" />
                    <button name="unlink_pending_stock_movement" string="Unlink stock move"
                        type="object" confirm="Confirm remove of pending stock movement?"
                        icon="fa-minus-square fa-2x" attrs="{'invisible': [('dropship_manage','=',True)]}"
                        groups="tyres_logistic_management.group_logistic_account_manager,tyres_logistic_management.group_logistic_manager"
                        />
                    <button name="hide_pending_stock_movement" string="Hide stock move"
                        type="object" confirm="This line never delivered, confirm hide stock movement?"
                        icon="fa-eye-slash fa-2x" attrs="{'invisible': [('force_hide','=',True)]}"
                        groups="tyres_logistic_management.group_logistic_account_manager,tyres_logistic_management.group_logistic_manager"
                        />
                    <button name="unhide_pending_stock_movement" string="Hide stock move"
                        type="object"
                        icon="fa-eye fa-2x" attrs="{'invisible': [('force_hide','=',False)]}"
                        groups="tyres_logistic_management.group_logistic_account_manager,tyres_logistic_management.group_logistic_manager"
                        />
                    <!--TODO-->
                </tree>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_purchase_selection_order_line">
            <field name="name">Delivery PO pending</field>
            <field name="res_model">purchase.order.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_delivery_selection_tree"/>
            <field name="search_view_id" ref="view_delivery_selection_search"/>
            <!--<field name="context">{'form_view_ref': 'logistic_pick_in_load.view_delivery_selection_form'}</field>-->
            <field name="domain">[('dropship_manage', '=', False), ('check_status', '!=', 'done'), ('order_id.logistic_state', '=', 'confirmed'),
                '|', ('user_select_id', '=', uid), ('user_select_id', '=', False), ('order_id.partner_id.internal_stock', '=', False)]</field><!--('logistic_delivered_qty', '&lt;', 'product_qty'), TODO ('delivery_id','=',False), -->
        </record>
        <record model="ir.actions.act_window" id="action_purchase_selection_order_internal_line">
            <field name="name">Delivery PO internal</field>
            <field name="res_model">purchase.order.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_delivery_selection_tree"/>
            <field name="search_view_id" ref="view_delivery_selection_search"/>
            <field name="context">{'internal_view': True, 'search_default_no_refund_selection': True}</field>
            <field name="domain">[('dropship_manage', '=', False), ('check_status', '!=', 'done'), ('order_id.logistic_state', '=', 'confirmed'),
                '|', ('user_select_id', '=', uid), ('user_select_id', '=', False), ('order_id.partner_id.internal_stock', '=', False)]</field><!--('logistic_delivered_qty', '&lt;', 'product_qty'), TODO ('delivery_id','=',False), -->
        </record>

        <record model="ir.actions.act_window" id="action_stock_move_selection_order_to_link_line">
            <field name="name">Assign BF document</field>
            <field name="res_model">stock.move</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_delivery_selection_stock_move_tree"/>
            <field name="search_view_id" ref="view_delivery_selection_stock_move_search"/>
            <field name="context">{}</field>
            <field name="domain">[('force_hide', '=', False), ('delivery_id', '=', False), ('picking_id', '=', False)]</field>
        </record>
        <record model="ir.actions.act_window" id="action_stock_move_selection_order_to_link_hided_line">
            <field name="name">Hided lines</field>
            <field name="res_model">stock.move</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_delivery_selection_stock_move_tree"/>
            <field name="search_view_id" ref="view_delivery_selection_stock_move_search"/>
            <field name="context">{}</field>
            <field name="domain">[('force_hide', '=', True)]</field>
        </record>

        <record model="ir.actions.act_window" id="action_purchase_order_line">
            <field name="name">Purchase line</field>
            <field name="res_model">purchase.order.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_purchase_order_line_tree"/>
            <field name="context">{'form_view_ref': 'logistic_pick_in_load.view_purchase_order_line_form'}</field>
            <field name="domain">[]</field>
        </record>

        <!--stock.picking.delivery-->
        <record model="ir.ui.view" id="view_stock_picking_delivery_search">
            <field name="name">stock.picking.delivery.search</field>
            <field name="model">stock.picking.delivery</field>
            <field name="arch" type="xml">
                <search string="String">
                    <field name="name" />
                    <field name="supplier_id" filter_domain="[('supplier_id.name','ilike',self)]"/>
                    <field name="product_id" />
                    <field name="quant_id" />
                    <field name="picking_id" />
                    <field name="date" />
                    <field name="create_uid" />

                    <!--<filter name="my_order" string="My" domain="[('create_uid','=',user.id)]"/>-->
                    <group expand="0" string="Group By...">
                        <filter name="group_supplier" string="Supplier" context="{'group_by': 'supplier_id'}"/>
                        <filter name="group_date" string="Date" context="{'group_by': 'date'}"/>
                        <filter name="group_date_week" string="Week" context="{'group_by': 'date:week'}"/>
                        <filter name="group_date_day" string="Day" context="{'group_by': 'date:day'}"/>
                    </group>
                </search>
            </field>
        </record>
        <record model="ir.ui.view" id="view_stock_picking_delivery_tree">
            <field name="name">stock.picking.delivery.tree</field>
            <field name="model">stock.picking.delivery</field>
            <field name="arch" type="xml">
                <tree string="Delivery" decoration-primary="picking_id==False">
                    <field name="name" />
                    <field name="supplier_id" />
                    <field name="create_date" />
                    <field name="create_uid" />
                    <field name="carrier_id" />
                    <field name="picking_id" />
                    <!--<field name="purchase_line_ids" />-->
                </tree>
            </field>
        </record>
        <record model="ir.ui.view" id="view_stock_picking_delivery_form">
            <field name="name">stock.picking.delivery.form</field>
            <field name="model">stock.picking.delivery</field>
            <field name="arch" type="xml">
                <form string="Delivery">
                    <header>
                        <button name="confirm_stock_load" string="Load stock" type="object" attrs="{'invisible': [('picking_id','!=',False)]}" class="oe_highlight" confirm="Confirm load operation?"/>
                        <button name="assign_refund_counter_sequence" string="Assegna numero reso" type="object" attrs="{'invisible': [('name','not in',('', ' '))]}" />

                    </header>
                    <sheet>
                        <group colspan="4" col="4">
                            <field name="name" required="1"/>
                            <field name="create_uid" readonly="1"/>

                            <field name="supplier_id" required="1"/>
                            <field name="carrier_id" />

                            <field name="create_date" readonly="1"/>
                            <field name="date" required="1" />
                            <field name="picking_id" attrs="{'invisible': [('picking_id','=',False)]}" readonly="1"/>

                            <notebook colspan="4">
                                <page string="Stock move:">
                                    <group colspan="4" col="4">
                                        <separator string="Stock move:" colspan="4"/>
                                        <field name="move_line_ids" colspan="4" nolabel="1" >
                                            <tree string="Load move" editable="bottom" create="false" delete="false" >
                                                 <field name="partner_id" readonly="1"/>
                                                 <field name="default_code" readonly="1"/>
                                                 <field name="name_extended" readonly="1" />
                                                 <field name="product_uom_qty" readonly="1" />
                                                 <field name="price_unit"/>
                                                 <field name="dropship_manage" invisible="1"/>
                                            </tree>
                                        </field>
                                    </group>
                                </page>
                                <page string="Extra stock:">
                                    <group colspan="4" col="4">
                                        <separator string="Account extra stock:" colspan="4"/>
                                        <field name="quant_ids" colspan="4" nolabel="1">
                                            <tree string="Stock quant:" editable="bottom" decoration-success="account_sync==True">
                                                <field name="product_id" />
                                                <field name="product_qty" />
                                                <field name="price" />
                                                <field name="account_sync" invisible="1"/>
                                            </tree>
                                        </field>
                                    </group>
                                </page>
                            </notebook>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record model="ir.actions.act_window" id="action_my_stock_picking_delivery_tree">
            <field name="name">My delivery pending</field>
            <field name="res_model">stock.picking.delivery</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_stock_picking_delivery_tree"/>
            <field name="context">{}</field>
            <field name="domain">[('create_uid', '=', uid), ('picking_id', '=', False)]</field>
        </record>
        <record model="ir.actions.act_window" id="action_stock_picking_delivery_tree">
            <field name="name">All delivery</field>
            <field name="res_model">stock.picking.delivery</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_stock_picking_delivery_tree"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>
        <record model="ir.actions.act_window" id="action_stock_picking_delivery_form">
            <field name="name">New Delivery</field>
            <field name="res_model">stock.picking.delivery</field>
            <field name="view_type">form</field>
            <field name="view_mode">form,tree</field>
            <field name="view_id" ref="view_stock_picking_delivery_form"/>
            <field name="context">{}</field>
            <field name="domain">[]</field>
        </record>

        <record model="ir.ui.view" id="view_sale_order_ready_tree">
            <field name="name">sale.order.tree</field>
            <field name="model">sale.order</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <tree string="Sale order ready (highlith no label line)" decoration-info="get_label_status=='manual'" decoration-danger="get_label_status=='error'" decoration-success="get_label_status=='shippy'">
                    <field name="name" />
                    <field name="locked_delivery" invisible="1"/>
                    <button name="locked_delivery_on" string="Lock delivery" type="object" attrs="{'invisible': [('locked_delivery','=',True)]}" icon="fa-lock"/><!--attrs="{'invisible': [('logistic_state','!=',('draft', 'order', 'pending'))]}"-->
                    <button name="locked_delivery_off" string="Unlock delivery" type="object" attrs="{'invisible': [('locked_delivery','=',False)]}" icon="fa-mail-reply"/>
	                <field name="date_order" />
	                <field name="partner_id" />
	                <field name="partner_shipping_id" />
	                <field name="amount_total" sum="Totale (Imposte incluse)" widget="monetary" invisible="1" />
	                <field name="team_id" />
	                <field name="carrier_ok" invisible="1"/>
	                <field name="carrier_stock_note" />
	                <field name="logistic_state" invisible="1"/>
	                <!--<field name="mmac_shippy_order_id" invisible="1" />-->
	                <field name="check_need_invoice" invisible="1" />

                    <field name="mmac_tracking_inviato" invisible='1'/>
                    <button name="mmac_tracking_inviato" string='TR' icon="fa-truck text-danger" attrs="{'invisible': [('mmac_tracking_inviato','=',False)]}" />
                    <field name="mmac_fattura_inviata" invisible='1'/>
                    <button name="mmac_fattura_inviata" string='FT' icon="fa-dollar text-danger" attrs="{'invisible': [('mmac_fattura_inviata','=',False)]}" />

	                <field name="shippy_ship_error" string="Check" invisible="1"/><!--TODO hide-->
	                <!--<button name="launch_shippy_ship" string="Relaunch shippy ship call, missing data: carrier or mode, insert and press this button, if done confirm?"
	                    type="object" icon="fa-ban fa-2x" attrs="{'invisible': [('shippy_ship_error','!=','error')]}"
	                    confirm="Relaunch shippy ship call?" />-->
	                <field name="carrier_shippy" string="Shippy"/>
	                <field name="carrier_supplier_id" string="Carrier"/>
	                <field name="carrier_track_id" />

                    <field name="state" invisible="1" />
	                <field name="logistic_done" invisible="1" />

	                <field name="has_extra_document" invisible="1" />
	                <field name="has_label_to_print" invisible="1" />
	                <field name="get_label_status" invisible="1"/>
	                <field name="label_printed" invisible="1" />
	                <field name="mmac_fattura_generata" invisible="1"/>
	                <field name="mmac_print_status" invisible="1"/>
	                <field name="mmac_controllo_fattura" invisible="1"/>

	                <button name="workflow_ready_to_done_current_order" string="Vai in consegna" type="object" icon="fa-caret-square-o-right fa-2x" attrs="{'invisible': [('logistic_state','!=','ready')]}"/>
	                <button name="workflow_ready_print_picking" string="Print picking" type="object" icon="fa-file-o fa-2x" />
	                <button name="workflow_ready_print_ddt" string="Print DDT" type="object" icon="fa-file-text-o fa-2x" attrs="{'invisible': [('check_need_invoice','=',True)]}"/>

	                <button name="workflow_ready_print_invoice" string="Print invoice" type="object" icon="fa-qrcode fa-2x" attrs="{'invisible': [('check_need_invoice','=',False)]}"/>

                    <button name="workflow_ready_print_label" string="Print label" type="object" icon="fa-film fa-2x" attrs="{'invisible': [('has_label_to_print', '=', False)]}"/>
	                <button name="label_printed_ok" string="Label was printed" type="object" icon="fa-check fa-2x" attrs="{'invisible': [('label_printed', '=', False)]}"/>

	                <button name="workflow_ready_print_extra" string="Print extra doc." type="object" icon="fa-list-alt fa-2x" attrs="{'invisible': [('has_extra_document','=',False)]}"/>

                    <button name="dummy" string="Attendere" icon="fa fa-spinner fa-spin fa-2x" type="object" attrs="{'invisible': ['|',('check_need_invoice','=', False),('mmac_controllo_fattura','=', True)]}"/>
                    <button name="print_all_server_action" string="Print all" type="object" icon="fa-files-o fa-2x" attrs="{'invisible': ['|',('mmac_print_status','=', 'all'),('check_need_invoice','=', True),('mmac_controllo_fattura','=', False)]}"/>
                    <button name="dummy" string="Stampato" type="object" icon="fa fa-file fa-2x" attrs="{'invisible': [('mmac_print_status','!=', 'all')]}"/>

	                <button name="set_workflow_logistic_done" string="Done!" type="object" icon="fa-thumbs-up fa-2x" confirm="Confirm? (cannot print document after mark as done!)" attrs="{'invisible': [('logistic_done','=',True)]}"/>
	                <button name="set_workflow_logistic_undone" string="Undone!" type="object" icon="fa-thumbs-down fa-2x" confirm="Confirm? (cannot print document after mark as done!)" attrs="{'invisible': [('logistic_done','=',False)]}"/>
                </tree>
            </field>
        </record>
        <record model="ir.ui.view" id="view_sale_order_ready_sequential_print_tree">
            <field name="name">sale.order.tree</field>
            <field name="model">sale.order</field>
            <field name="priority" eval="40" />
            <field name="arch" type="xml">
                <tree string="Sale order ready (highlight no label line)" decoration-info="get_label_status=='manual'" decoration-danger="get_label_status=='error'" decoration-success="get_label_status=='shippy'">
                    <field name="name" />
	                <field name="date_order" />
	                <field name="partner_id" />
	                <field name="partner_shipping_id" />
	                <field name="amount_total" sum="Totale (Imposte incluse)" widget="monetary" invisible="1" />
	                <field name="team_id" />
	                <field name="carrier_ok" invisible="1"/>
	                <field name="carrier_stock_note" />
	                <field name="logistic_state" invisible="1"/>
	                <!--<field name="mmac_shippy_order_id" invisible="1" />-->
	                <field name="check_need_invoice" invisible="1" />

                    <field name="mmac_tracking_inviato" invisible='1'/>
                    <button name="mmac_tracking_inviato" string='TR' icon="fa-truck text-danger" attrs="{'invisible': [('mmac_tracking_inviato','=',False)]}" />
                    <field name="mmac_fattura_inviata" invisible='1'/>
                    <button name="mmac_fattura_inviata" string='FT' icon="fa-dollar text-danger" attrs="{'invisible': [('mmac_fattura_inviata','=',False)]}" />

	                <!--
	                <field name="carrier_shippy" string="Shippy"/>
	                <field name="carrier_track_id" />-->
                    <field name="shippy_ship_error" string="Check" invisible="1"/>
                    <field name="carrier_supplier_id" string="Carrier"/>

                    <field name="state" invisible="1" />
	                <field name="logistic_done" invisible="1" />
	                <field name="has_extra_document" invisible="1" />
	                <field name="has_label_to_print" invisible="1" />
	                <field name="get_label_status" invisible="1"/>
	                <field name="label_printed" invisible="1" />
	                <field name="mmac_fattura_generata" invisible="1"/>
	                <field name="mmac_print_status" invisible="1"/>
	                <field name="mmac_controllo_fattura" invisible="1"/>
	                <field name="sequential_printed" invisible="1"/>
	                <field name="invoice_detail" />
                    <button name="yet_sequential_printed" string="GiÃ  stampata" type="object" icon="fa-folder-open-o fa-2x" attrs="{'invisible': [('sequential_printed','=',True)]}"/>
	                <!--<button name="workflow_ready_to_done_current_order" string="Vai in consegna" type="object" icon="fa-caret-square-o-right fa-2x" attrs="{'invisible': [('logistic_state','!=','ready')]}"/>
	                <button name="workflow_ready_print_picking" string="Print picking" type="object" icon="fa-file-o fa-2x" />
	                <button name="workflow_ready_print_ddt" string="Print DDT" type="object" icon="fa-file-text-o fa-2x" attrs="{'invisible': [('check_need_invoice','=',True)]}"/>

	                <button name="workflow_ready_print_invoice" string="Print invoice" type="object" icon="fa-qrcode fa-2x" attrs="{'invisible': [('check_need_invoice','=',False)]}"/>

                    <button name="workflow_ready_print_label" string="Print label" type="object" icon="fa-film fa-2x" attrs="{'invisible': [('has_label_to_print', '=', False)]}"/>
	                <button name="label_printed_ok" string="Label was printed" type="object" icon="fa-check fa-2x" attrs="{'invisible': [('label_printed', '=', False)]}"/>

	                <button name="workflow_ready_print_extra" string="Print extra doc." type="object" icon="fa-list-alt fa-2x" attrs="{'invisible': [('has_extra_document','=',False)]}"/>

                    <button name="dummy" string="Attendere" icon="fa fa-spinner fa-spin fa-2x" type="object" attrs="{'invisible': ['|',('check_need_invoice','=', False),('mmac_controllo_fattura','=', True)]}"/>
                    <button name="print_all_server_action" string="Print all" type="object" icon="fa-files-o fa-2x" attrs="{'invisible': ['|',('mmac_print_status','=', 'all'),('check_need_invoice','=', True),('mmac_controllo_fattura','=', False)]}"/>
                    <button name="dummy" string="Stampato" type="object" icon="fa fa-file fa-2x" attrs="{'invisible': [('mmac_print_status','!=', 'all')]}"/>-->

	                <button name="set_workflow_logistic_done" string="Done!" type="object" icon="fa-thumbs-up fa-2x" confirm="Confirm? (cannot print document after mark as done!)" attrs="{'invisible': [('logistic_done','=',True)]}"/>
	                <button name="set_workflow_logistic_undone" string="Undone!" type="object" icon="fa-thumbs-down fa-2x" confirm="Confirm? (cannot print document after mark as done!)" attrs="{'invisible': [('logistic_done','=',False)]}"/>

                </tree>
            </field>
        </record>

         <record model="ir.ui.view" id="view_sale_order_logistic_manage_search">
             <field name="name">sale.order.logistic.mge.search</field>
             <field name="model">sale.order</field>
             <field name="inherit_id" ref="sale.view_sales_order_filter"/>
             <field name="arch" type="xml">
                 <field name="user_id" position="after">
                     <filter name="manage_office_id_office" string="Manage in office" domain="[('manage_office_id.code', '=', 'office')]"/>
                     <filter name="manage_office_id_workshop" string="Manage in workshop" domain="[('manage_office_id.code', '=', 'workshop')]"/>
                 </field>
             </field>
         </record>
         <record model="ir.actions.act_window" id="action_sale_order_ready_form">
             <field name="name">Sale order ready</field>
             <field name="res_model">sale.order</field>
             <field name="view_type">form</field>
             <field name="view_id" ref="view_sale_order_ready_tree"/>
             <field name="view_mode">tree,form,graph,pivot</field>
             <field name="context">{}</field>
             <field name="domain">[('logistic_source', 'not in', ('refund', )), ('logistic_state', 'in', ('ready', 'done')), ('logistic_done', '=', False), ('logistic_source', '!=', 'internal')]</field>
         </record>
         <record model="ir.actions.act_window" id="action_sale_order_ready_workshop_form">
             <field name="name">Sale order ready workshop</field>
             <field name="res_model">sale.order</field>
             <field name="view_type">form</field>
             <field name="view_id" ref="view_sale_order_ready_tree"/>
             <field name="view_mode">tree,form,graph,pivot</field>
             <field name="context">{}</field>
             <field name="domain">[('manage_office_id.code', '=', 'workshop'), ('logistic_source', 'not in', ('refund', )), ('logistic_state', 'in', ('ready', 'done')), ('logistic_done', '=', False), ('logistic_source', '!=', 'internal')]</field>
         </record>
         <record model="ir.actions.act_window" id="action_sale_order_ready_office_form">
             <field name="name">Sale order ready office</field>
             <field name="res_model">sale.order</field>
             <field name="view_type">form</field>
             <field name="view_id" ref="view_sale_order_ready_tree"/>
             <field name="view_mode">tree,form,graph,pivot</field>
             <field name="context">{}</field>
             <field name="domain">[('manage_office_id.code', '=', 'office'), ('logistic_source', 'not in', ('refund', )), ('logistic_state', 'in', ('ready', 'done')), ('logistic_done', '=', False), ('logistic_source', '!=', 'internal')]</field>
         </record>
         <record model="ir.actions.act_window" id="action_sale_order_ready_sequential_print_form">
             <field name="name">Sale order sequential print</field>
             <field name="res_model">sale.order</field>
             <field name="view_type">form</field>
             <field name="view_id" ref="view_sale_order_ready_sequential_print_tree"/>
             <field name="view_mode">tree,form,graph,pivot</field>
             <field name="context">{}</field>
             <field name="domain">[ ('need_invoice', '=', True),('fiscal_position_id.sequential_print', '=', True), ('sequential_printed', '=', False), ('logistic_source', 'not in', ('refund', )), ('logistic_state', '=', 'done'), ('locked_delivery', '=', False), ('logistic_source', '!=', 'internal')]</field>
             <!--(logistic_picking_ids[0].invoice_number != 'DA ASSEGNARE'),-->
         </record> <!--('logistic_done', '=', False), -->

         <record model="ir.actions.act_window" id="action_sale_order_closed_form">
             <field name="name">Sale order ready</field>
             <field name="res_model">sale.order</field>
             <field name="view_type">form</field>
             <field name="view_id" ref="view_sale_order_ready_tree"/>
             <field name="view_mode">tree,form,graph,pivot</field>
             <field name="context">{}</field>
             <field name="domain">[('logistic_source', 'not in', ('refund', )), ('locked_delivery', '=', False), ('logistic_done', '=', True), ('logistic_source', '!=', 'internal')]</field>
         </record>
        <menuitem
             id="menu_purchase_order_line"
             parent="tyres_logistic_management.menu_logistic_management_root"
             action="action_purchase_order_line"
             sequence="30"
             />

        <menuitem
             id="menu_logistic_delivery_management_root"
             parent="tyres_logistic_management.menu_logistic_header_root"
             name="Manage supplier delivery"
             sequence="29"
             />

             <menuitem
                 parent="menu_logistic_delivery_management_root"
                 id="menu_purchase_selection_order_line"
                 action="action_purchase_selection_order_line"
                 sequence="5"
                 />
             <menuitem
                 parent="menu_logistic_delivery_management_root"
                 id="menu_purchase_selection_order_internal_line"
                 action="action_purchase_selection_order_internal_line"
                 sequence="6"
                 />


             <menuitem
                 parent="menu_logistic_delivery_management_root"
                 id="menu_purchase_selection_order_link_line"
                 action="action_stock_move_selection_order_to_link_line"
                 sequence="10"
                 groups="tyres_logistic_management.group_logistic_account_manager,tyres_logistic_management.group_logistic_manager"
                 />

                 <menuitem
                     parent="menu_purchase_selection_order_link_line"
                     id="menu_purchase_selection_order_link_line_hided"
                     action="action_stock_move_selection_order_to_link_hided_line"
                     sequence="10"
                     groups="tyres_logistic_management.group_logistic_account_manager,tyres_logistic_management.group_logistic_manager"
                     />

             <menuitem
                 parent="menu_logistic_delivery_management_root"
                 id="menu_my_stock_picking_delivery_tree"
                 action="action_my_stock_picking_delivery_tree"
                 sequence="20"
                 groups="tyres_logistic_management.group_logistic_account_manager,tyres_logistic_management.group_logistic_manager"
                 />
             <menuitem
                 parent="menu_logistic_delivery_management_root"
                 id="menu_stock_picking_delivery_tree"
                 action="action_stock_picking_delivery_tree"
                 sequence="30"
                 groups="tyres_logistic_management.group_logistic_account_manager,tyres_logistic_management.group_logistic_manager"
                 />

             <menuitem
                 id="menu_logistic_ready_order_to_send"
                 parent="menu_logistic_delivery_management_root"
                 name="Order ready"
                 action="action_sale_order_ready_form"
                 sequence="40"
                 />
             <menuitem
                 id="menu_logistic_ready_order_to_send_office"
                 parent="menu_logistic_delivery_management_root"
                 name="Order ready (office)"
                 action="action_sale_order_ready_office_form"
                 sequence="41"
                 />
             <menuitem
                 id="menu_logistic_ready_order_to_send_workshop"
                 parent="menu_logistic_delivery_management_root"
                 name="Order ready (workshop)"
                 action="action_sale_order_ready_workshop_form"
                 sequence="42"
                 />
             <menuitem
                 id="menu_logistic_ready_order_to_send_sequential_print"
                 parent="menu_logistic_delivery_management_root"
                 name="Stampa fatture (seq.)"
                 action="action_sale_order_ready_sequential_print_form"
                 sequence="45"
                 />
             <menuitem
                 id="menu_logistic_ready_order_to_send_closed"
                 parent="menu_logistic_delivery_management_root"
                 name="Order closed"
                 action="action_sale_order_closed_form"
                 sequence="50"
                 />

             <menuitem
                 id="menu_action_res_company_parameter_print"
                 parent="tyres_logistic_management.menu_logistic_left_configuration_root"
                 action="action_account_fiscal_position_print_form"
                 sequence="70"
                 />

    </data>
</openerp>
